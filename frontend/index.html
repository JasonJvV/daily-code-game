<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Code Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: #000000;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(255,255,255,0.1);
            padding: 30px;
            max-width: 480px;
            width: 100%;
            border: 2px solid #333;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header-row {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
            position: relative;
        }

        .puzzle-info {
            color: #ccc;
            font-size: 0.95em;
            text-align: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 0;
        }

        .duplicates-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px;
            z-index: 1;
        }

        .duplicates-label {
            color: #ccc;
            font-size: 0.9em;
        }

        .title {
            font-size: 2.2em;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            text-align: center;
        }

        .toggle {
            position: relative;
            width: 35px;
            height: 18px;
            background: #ccc;
            border-radius: 9px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle.active {
            background: #4CAF50;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle.active .toggle-slider {
            transform: translateX(17px);
        }

        .timer-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #ccc;
        }

        .color-palette {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .color-btn {
            width: 45px;
            height: 45px;
            border: 3px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: white;
            background: #333;
            transition: all 0.3s;
        }

        .color-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .color-btn.eliminated {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .color-btn.eliminated:hover {
            transform: none;
            box-shadow: none;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: #0056b3;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #545b62;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .guess-board {
            margin-bottom: 25px;
        }

        .guess-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            justify-content: center;
            align-items: center;
        }

        .feedback-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 2px;
            margin-left: 15px;
            width: 20px;
            height: 20px;
        }

        .feedback-dot {
            width: 8px;
            height: 8px;
            border-radius: 2px;
            background: #444;
        }

        .feedback-dot.correct {
            background: #28a745;
        }

        .feedback-dot.wrong-position {
            background: #ffc107;
        }

        .guess-slot {
            width: 50px;
            height: 50px;
            border: 3px solid #444;
            border-radius: 50%;
            background: #222;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .guess-slot.filled {
            border-color: #fff;
            background: #333;
        }

        .guess-slot.active {
            border-color: #007bff;
            border-style: dashed;
        }

        .guess-slot:hover {
            border-color: #007bff;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .hint-section {
            text-align: center;
            margin-bottom: 15px;
        }

        .hint-section .btn {
            background: #ffc107;
            color: black;
        }

        .stat-card {
            background: #222;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #444;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #007bff;
        }

        .stat-label {
            font-size: 0.85em;
            color: #ccc;
            margin-top: 5px;
        }

        @media (max-width: 480px) {
            .game-container {
                padding: 20px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1 class="title">Daily Code</h1>
            <div class="header-row">
                <div class="duplicates-container">
                    <span class="duplicates-label">Duplicates</span>
                    <div class="toggle" id="duplicates-toggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="puzzle-info">
                    <div id="puzzle-number">Puzzle #1</div>
                    <div id="date-info"></div>
                </div>
            </div>
        </div>

        <div class="timer-info">
            <span>Guess: <span id="guess-count">1</span>/10</span>
            <span>Time: <span id="timer">00:00</span></span>
        </div>

        <div class="hint-section" id="hint-section" style="display: none;">
            <button class="btn btn-secondary" id="hint-btn">Use Hint (Eliminate 1 Number)</button>
        </div>

        <div class="color-palette" id="color-palette"></div>

        <div class="controls">
            <button class="btn btn-secondary" id="clear-btn">Clear</button>
            <button class="btn btn-primary" id="submit-btn" disabled>Submit Guess</button>
        </div>

        <div class="guess-board" id="guess-board"></div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-value" id="current-streak">0</div>
                <div class="stat-label">Current Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="max-streak">0</div>
                <div class="stat-label">Max Streak</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avg-guesses">-</div>
                <div class="stat-label">Avg Guesses</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="games-played">0</div>
                <div class="stat-label">Games Played</div>
            </div>
        </div>
    </div>

    <script>
        class DailyCodeGame {
            constructor() {
                this.numbers = [
                    { name: '1', value: 1 },
                    { name: '2', value: 2 },
                    { name: '3', value: 3 },
                    { name: '4', value: 4 },
                    { name: '5', value: 5 },
                    { name: '6', value: 6 }
                ];
                
                this.secretCode = [];
                this.currentGuess = [null, null, null, null];
                this.guesses = [];
                this.gameOver = false;
                this.gameWon = false;
                this.startTime = Date.now();
                this.duplicatesAllowed = false;
                this.hintsUsed = 0;
                this.eliminatedColors = new Set();
                this.currentRow = 0;
                
                this.initializeGame();
                this.setupEventListeners();
                this.updateDisplay();
                this.startTimer();
                this.loadStats();
            }

            generateDailyCode() {
                const today = new Date();
                const dateString = today.toISOString().split('T')[0];
                const seed = this.hashCode(dateString);
                
                const rng = this.seededRandom(seed);
                const code = [];
                
                for (let i = 0; i < 4; i++) {
                    const availableNumbers = this.duplicatesAllowed ? 
                        this.numbers : 
                        this.numbers.filter(n => !code.some(existing => existing.name === n.name));
                    
                    const randomIndex = Math.floor(rng() * availableNumbers.length);
                    code.push(availableNumbers[randomIndex]);
                }
                
                return code;
            }

            hashCode(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash);
            }

            seededRandom(seed) {
                let state = seed;
                return function() {
                    state = (state * 1664525 + 1013904223) % 4294967296;
                    return state / 4294967296;
                };
            }

            initializeGame() {
                this.secretCode = this.generateDailyCode();
                this.updatePuzzleInfo();
                this.renderGuessBoard();
                this.renderColorPalette();
            }

            updatePuzzleInfo() {
                const today = new Date();
                const startDate = new Date('2024-01-01');
                const daysDiff = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
                
                document.getElementById('puzzle-number').textContent = `Puzzle #${daysDiff + 1}`;
                document.getElementById('date-info').textContent = today.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            setupEventListeners() {
                const duplicatesToggle = document.getElementById('duplicates-toggle');
                duplicatesToggle.addEventListener('click', () => {
                    this.duplicatesAllowed = !this.duplicatesAllowed;
                    duplicatesToggle.classList.toggle('active', this.duplicatesAllowed);
                    this.restartGame();
                });

                document.getElementById('clear-btn').addEventListener('click', () => {
                    this.clearCurrentGuess();
                });

                document.getElementById('submit-btn').addEventListener('click', () => {
                    this.submitGuess();
                });

                document.getElementById('hint-btn').addEventListener('click', () => {
                    this.useHint();
                });
            }

            renderGuessBoard() {
                const board = document.getElementById('guess-board');
                board.innerHTML = '';

                for (let row = 0; row < 10; row++) {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'guess-row';
                    
                    const guessContainer = document.createElement('div');
                    guessContainer.style.display = 'flex';
                    guessContainer.style.gap = '8px';
                    
                    for (let col = 0; col < 4; col++) {
                        const slot = document.createElement('div');
                        slot.className = 'guess-slot';
                        slot.id = `guess-${row}-${col}`;
                        slot.addEventListener('click', () => this.onSlotClick(row, col));
                        guessContainer.appendChild(slot);
                    }
                    
                    const feedbackContainer = document.createElement('div');
                    feedbackContainer.className = 'feedback-container';
                    feedbackContainer.id = `feedback-${row}`;
                    feedbackContainer.style.visibility = 'hidden';
                    
                    for (let i = 0; i < 4; i++) {
                        const dot = document.createElement('div');
                        dot.className = 'feedback-dot';
                        feedbackContainer.appendChild(dot);
                    }
                    
                    rowDiv.appendChild(guessContainer);
                    rowDiv.appendChild(feedbackContainer);
                    board.appendChild(rowDiv);
                }
                
                this.updateCurrentRowDisplay();
            }

            renderColorPalette() {
                console.log('Creating number palette...');
                const palette = document.getElementById('color-palette');
                palette.innerHTML = '';

                this.numbers.forEach((number, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'color-btn';
                    btn.textContent = number.value;
                    
                    btn.addEventListener('click', () => {
                        console.log('Number clicked:', number.value);
                        this.selectNumber(number);
                    });
                    
                    palette.appendChild(btn);
                });

                this.updateNumberPalette();
            }

            updateNumberPalette() {
                const buttons = document.querySelectorAll('.color-btn');
                buttons.forEach((btn, index) => {
                    const number = this.numbers[index];
                    btn.classList.toggle('eliminated', this.eliminatedColors.has(number.name));
                });
            }

            selectNumber(number) {
                console.log('selectNumber called with:', number.value);
                
                if (this.gameOver || this.eliminatedColors.has(number.name)) {
                    console.log('Blocked: game over or eliminated');
                    return;
                }

                const emptySlot = this.currentGuess.findIndex(slot => slot === null);
                console.log('Empty slot at index:', emptySlot);
                
                if (emptySlot !== -1) {
                    this.currentGuess[emptySlot] = number;
                    console.log('Added number, currentGuess now:', this.currentGuess);
                    this.updateCurrentRowDisplay();
                    this.updateSubmitButton();
                }
            }

            onSlotClick(row, col) {
                if (this.gameOver || row !== this.currentRow) return;
                
                if (this.currentGuess[col] !== null) {
                    this.currentGuess[col] = null;
                    this.updateCurrentRowDisplay();
                    this.updateSubmitButton();
                }
            }

            updateCurrentRowDisplay() {
                // Clear all active states
                for (let row = 0; row < 10; row++) {
                    for (let col = 0; col < 4; col++) {
                        const slot = document.getElementById(`guess-${row}-${col}`);
                        if (slot) {
                            slot.classList.remove('active');
                        }
                    }
                }
                
                // Only highlight current row
                if (!this.gameOver && this.currentRow < 10) {
                    for (let col = 0; col < 4; col++) {
                        const slot = document.getElementById(`guess-${this.currentRow}-${col}`);
                        if (slot) {
                            const number = this.currentGuess[col];
                            
                            if (number) {
                                slot.classList.add('filled');
                                slot.classList.remove('active');
                                slot.textContent = number.value;
                            } else {
                                slot.classList.remove('filled');
                                slot.classList.add('active');
                                slot.textContent = '';
                            }
                        }
                    }
                }
            }

            clearCurrentGuess() {
                if (this.gameOver) return;
                this.currentGuess = [null, null, null, null];
                this.updateCurrentRowDisplay();
                this.updateSubmitButton();
            }

            updateSubmitButton() {
                const submitBtn = document.getElementById('submit-btn');
                const isComplete = this.currentGuess.every(slot => slot !== null);
                submitBtn.disabled = !isComplete || this.gameOver;
            }

            submitGuess() {
                if (this.gameOver || this.currentGuess.some(slot => slot === null)) return;

                const guess = [...this.currentGuess];
                this.guesses.push(guess);

                const feedback = this.getFeedback(guess);
                this.displayGuess(this.currentRow, guess, feedback);

                if (feedback.every(f => f === 'correct')) {
                    this.endGame(true);
                } else if (this.guesses.length >= 10) {
                    this.endGame(false);
                } else {
                    this.currentGuess = [null, null, null, null];
                    this.currentRow++;
                    this.updateCurrentRowDisplay();
                    this.updateSubmitButton();
                    this.updateGuessCount();
                    this.checkHintAvailability();
                }
            }

            checkHintAvailability() {
                const hintSection = document.getElementById('hint-section');
                const hintBtn = document.getElementById('hint-btn');
                
                if (this.guesses.length >= 5 && this.hintsUsed === 0) {
                    hintSection.style.display = 'block';
                } else {
                    hintBtn.disabled = this.hintsUsed > 0;
                }
            }

            useHint() {
                if (this.hintsUsed > 0 || this.gameOver) return;

                const incorrectNumbers = this.numbers.filter(number => 
                    !this.secretCode.some(secret => secret.name === number.name) &&
                    !this.eliminatedColors.has(number.name)
                );

                if (incorrectNumbers.length > 0) {
                    const randomIncorrect = incorrectNumbers[Math.floor(Math.random() * incorrectNumbers.length)];
                    this.eliminatedColors.add(randomIncorrect.name);
                    this.hintsUsed++;
                    this.updateNumberPalette();
                    
                    document.getElementById('hint-btn').disabled = true;
                    document.getElementById('hint-btn').textContent = 'Hint Used';
                }
            }

            getFeedback(guess) {
                const feedback = [];
                const secretCopy = [...this.secretCode];
                const guessCopy = [...guess];

                // First pass: mark correct positions
                for (let i = 0; i < 4; i++) {
                    if (guessCopy[i].name === secretCopy[i].name) {
                        feedback[i] = 'correct';
                        secretCopy[i] = null;
                        guessCopy[i] = null;
                    }
                }

                // Second pass: mark wrong positions
                for (let i = 0; i < 4; i++) {
                    if (guessCopy[i] !== null) {
                        const secretIndex = secretCopy.findIndex(c => c && c.name === guessCopy[i].name);
                        if (secretIndex !== -1) {
                            feedback[i] = 'wrong-position';
                            secretCopy[secretIndex] = null;
                        } else {
                            feedback[i] = 'incorrect';
                        }
                    }
                }

                return feedback;
            }

            displayGuess(rowIndex, guess, feedback) {
                // Display numbers
                for (let i = 0; i < 4; i++) {
                    const slot = document.getElementById(`guess-${rowIndex}-${i}`);
                    slot.classList.add('filled');
                    slot.classList.remove('active');
                    slot.textContent = guess[i].value;
                }
                
                // Display feedback dots
                const feedbackContainer = document.getElementById(`feedback-${rowIndex}`);
                feedbackContainer.style.visibility = 'visible';
                const dots = feedbackContainer.querySelectorAll('.feedback-dot');
                
                const sortedFeedback = [...feedback].sort((a, b) => {
                    if (a === 'correct' && b !== 'correct') return -1;
                    if (b === 'correct' && a !== 'correct') return 1;
                    if (a === 'wrong-position' && b === 'incorrect') return -1;
                    if (b === 'wrong-position' && a === 'incorrect') return 1;
                    return 0;
                });
                
                sortedFeedback.forEach((feedbackType, index) => {
                    if (index < 4) {
                        if (feedbackType === 'correct') {
                            dots[index].classList.add('correct');
                        } else if (feedbackType === 'wrong-position') {
                            dots[index].classList.add('wrong-position');
                        }
                    }
                });
            }

            endGame(won) {
                this.gameOver = true;
                this.gameWon = won;
                
                if (won) {
                    alert(`Congratulations! You solved it in ${this.guesses.length} guesses!`);
                } else {
                    alert('Game Over! Better luck tomorrow!');
                }
            }

            updateGuessCount() {
                document.getElementById('guess-count').textContent = this.guesses.length + 1;
            }

            startTimer() {
                setInterval(() => {
                    if (!this.gameOver) {
                        const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
                        const minutes = Math.floor(elapsed / 60);
                        const seconds = elapsed % 60;
                        document.getElementById('timer').textContent = 
                            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    }
                }, 1000);
            }

            getStats() {
                return {
                    gamesPlayed: 0,
                    gamesWon: 0,
                    currentStreak: 0,
                    maxStreak: 0,
                    totalGuesses: 0
                };
            }

            loadStats() {
                const stats = this.getStats();
                document.getElementById('current-streak').textContent = stats.currentStreak;
                document.getElementById('max-streak').textContent = stats.maxStreak;
                document.getElementById('games-played').textContent = stats.gamesPlayed;
                document.getElementById('avg-guesses').textContent = '-';
            }

            updateDisplay() {
                this.renderColorPalette();
                this.updateCurrentRowDisplay();
            }

            restartGame() {
                this.secretCode = this.generateDailyCode();
                this.currentGuess = [null, null, null, null];
                this.guesses = [];
                this.gameOver = false;
                this.gameWon = false;
                this.startTime = Date.now();
                this.hintsUsed = 0;
                this.eliminatedColors.clear();
                this.currentRow = 0;
                
                document.getElementById('guess-count').textContent = '1';
                document.getElementById('hint-section').style.display = 'none';
                
                this.renderGuessBoard();
                this.renderColorPalette();
                this.updateSubmitButton();
            }
        }

        // Initialize the game when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new DailyCodeGame();
        });
    </script>
</body>
</html>
